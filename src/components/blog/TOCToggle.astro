---
---

<button
  id="toc-toggle"
  class="fixed top-4 right-4 z-50 rounded-full bg-zinc-200 p-2 shadow-lg transition-all hover:bg-zinc-300 hover:shadow-xl dark:bg-zinc-700 dark:hover:bg-zinc-600 lg:top-6 lg:right-6"
  aria-label="目次の表示を切り替え"
  title="目次の表示を切り替え"
>
  <svg
    class="h-5 w-5"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 6h16M4 12h16M4 18h7"
    ></path>
  </svg>
</button>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const tocToggle = document.getElementById('toc-toggle');
    const tocElement = document.querySelector('[data-toc]');
    
    if (!tocToggle || !tocElement) return;

    // 初期状態を設定（デフォルトで表示）
    let isVisible = true;
    
    // LocalStorageから前回の状態を復元
    const savedState = localStorage.getItem('toc-visible');
    if (savedState !== null) {
      isVisible = savedState === 'true';
    }
    
    // 初期状態を適用
    updateTOCVisibility();
    
    // ボタンクリック時のイベントリスナー
    tocToggle.addEventListener('click', () => {
      isVisible = !isVisible;
      updateTOCVisibility();
      localStorage.setItem('toc-visible', isVisible.toString());
    });
    
    function updateTOCVisibility() {
      if (!tocElement || !tocToggle) return;
      
      if (isVisible) {
        tocElement.classList.remove('hidden');
        tocToggle.setAttribute('aria-expanded', 'true');
      } else {
        tocElement.classList.add('hidden');
        tocToggle.setAttribute('aria-expanded', 'false');
      }
    }
  });
</script>